{
  "info": {
    "name": "Tennis API - Posts",
    "description": "Automated collection for posting and making comments",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. AUTH - Register User",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201 || pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    console.log('üì¶ Response:', JSON.stringify(response, null, 2));",
              "    ",
              "    const user = response.user || response;",
              "    const userId = user.id || user._id;",
              "    const userName = user.name;",
              "    ",
              "    if (userId) {",
              "        pm.environment.set('user_id', userId);",
              "        console.log('‚úÖ User ID saved:', userId);",
              "    }",
              "    ",
              "    if (userName) {",
              "        pm.environment.set('user_name', userName);",
              "        console.log('‚úÖ User name saved:', userName);",
              "    }",
              "} else {",
              "    console.error('‚ùå Error in registration:', pm.response.code);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"John Doe\",\n  \"email\": \"john.doe@email.com\",\n  \"password\": \"1234\",\n  \"role\": \"user\",\n  \"level\": \"intermediate\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/auth/register",
          "host": ["{{base_url}}"],
          "path": ["api", "auth", "register"]
        },
        "description": "Register a new user and save their ID and name in variables"
      }
    },
    {
      "name": "2. AUTH - Login",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    const user = response.user;",
              "    ",
              "    if (user && user.id) {",
              "        pm.environment.set('user_id', user.id);",
              "        pm.environment.set('user_name', user.name);",
              "        console.log('‚úÖ User ID saved:', user.id);",
              "        console.log('‚úÖ User name saved:', user.name);",
              "    }",
              "    ",
              "    if (response.token) {",
              "        pm.environment.set('auth_token', response.token);",
              "        console.log('‚úÖ Token saved');",
              "    }",
              "} else {",
              "    console.error('‚ùå Error in login:', pm.response.code);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"john.doe@email.com\",\n  \"password\": \"1234\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/auth/login",
          "host": ["{{base_url}}"],
          "path": ["api", "auth", "login"]
        },
        "description": "Login and update user_id and user_name variables"
      }
    },
    {
      "name": "3. POSTS - Create Post",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "const userId = pm.environment.get('user_id');",
              "const userName = pm.environment.get('user_name');",
              "",
              "console.log('üîç Checking variables before request:');",
              "console.log('   user_id:', userId || '‚ùå NOT DEFINED');",
              "console.log('   user_name:', userName || '‚ùå NOT DEFINED');",
              "",
              "if (!userId || !userName) {",
              "    console.error('‚ùå ERROR: Run \"1. AUTH - Register User\" or \"2. AUTH - Login\" first');",
              "    throw new Error('Variables user_id or user_name are not defined. Run registration or login first.');",
              "}"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    console.log('üì¶ Response:', JSON.stringify(response, null, 2));",
              "    ",
              "    const post = response.post;",
              "    ",
              "    if (post && post.id) {",
              "        pm.environment.set('post_id', post.id);",
              "        console.log('‚úÖ Post ID saved:', post.id);",
              "    } else if (post && post._id) {",
              "        pm.environment.set('post_id', post._id);",
              "        console.log('‚úÖ Post ID saved:', post._id);",
              "    } else {",
              "        console.error('‚ùå post.id not found in response');",
              "    }",
              "} else {",
              "    console.error('‚ùå Error creating post:', pm.response.code);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"author_id\": \"{{user_id}}\",\n  \"author_name\": \"{{user_name}}\",\n  \"type\": \"discussion\",\n  \"category\": \"technique\",\n  \"title\": \"How to improve backhand?\",\n  \"content\": \"I've been practicing for a while but I'm still struggling. What should I do?\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/posts",
          "host": ["{{base_url}}"],
          "path": ["api", "posts"]
        },
        "description": "Create a post using saved variables"
      }
    },
    {
      "name": "4. POSTS - Get Post",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/posts/{{post_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "posts", "{{post_id}}"]
        },
        "description": "Get the created post by its ID"
      }
    },
    {
      "name": "5. POSTS - Update Post",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"user_id\": \"{{user_id}}\",\n  \"title\": \"I've improved my backhand\",\n  \"category\": \"matches\",\n  \"content\": \"I've improved a lot. Tomorrow I'm going to play tennis from 8 to 10. Who wants to join?\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/posts/{{post_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "posts", "{{post_id}}"]
        },
        "description": "Update the post"
      }
    },
    {
      "name": "6. POSTS - Like Post",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"user_id\": \"{{user_id}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/posts/{{post_id}}/like",
          "host": ["{{base_url}}"],
          "path": ["api", "posts", "{{post_id}}", "like"]
        },
        "description": "Give like to the post"
      }
    },
    {
      "name": "7. COMMENTS - Create Comment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    console.log('üì¶ Response:', JSON.stringify(response, null, 2));",
              "    ",
              "    // Try different response structures",
              "    let commentId = null;",
              "    ",
              "    if (response.comment) {",
              "        commentId = response.comment.id || response.comment._id;",
              "    } else {",
              "        commentId = response.id || response._id;",
              "    }",
              "    ",
              "    if (commentId) {",
              "        pm.environment.set('comment_id', commentId);",
              "        console.log('‚úÖ Comment ID saved:', commentId);",
              "    } else {",
              "        console.error('‚ùå Comment ID not found in response');",
              "        console.error('Received structure:', Object.keys(response));",
              "    }",
              "} else {",
              "    console.error('‚ùå Error creating comment:', pm.response.code);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"entity_type\": \"post\",\n  \"entity_id\": \"{{post_id}}\",\n  \"user_id\": \"{{user_id}}\",\n  \"user_name\": \"{{user_name}}\",\n  \"text\": \"As no one answers, I myself, will play the tennis match with myself\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/comments",
          "host": ["{{base_url}}"],
          "path": ["api", "comments"]
        },
        "description": "Create a comment on the post"
      }
    },
    {
      "name": "8. COMMENTS - Get Comment",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/comments/{{comment_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "comments", "{{comment_id}}"]
        },
        "description": "Get the comment by its ID"
      }
    },
  
    {
      "name": "10. POSTS - Get Post",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/posts/{{post_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "posts", "{{post_id}}"]
        },
        "description": "Get the post again to verify that the like and comment have been added correctly"
      }
    }
  ]
}