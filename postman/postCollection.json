{
  "info": {
    "name": "Tennis API - Posts ",
    "description": "Automated collection for posting and making comments",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "1. AUTH - Register User",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201 || pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    console.log('üì¶ Response:', JSON.stringify(response, null, 2));",
              "    ",
              "    const user = response.user || response;",
              "    const userId = user.id || user._id;",
              "    const userName = user.nombre;",
              "    ",
              "    if (userId) {",
              "        pm.environment.set('user_id', userId);",
              "        console.log('‚úÖ User ID guardado:', userId);",
              "    }",
              "    ",
              "    if (userName) {",
              "        pm.environment.set('user_nombre', userName);",
              "        console.log('‚úÖ User nombre guardado:', userName);",
              "    }",
              "} else {",
              "    console.error('‚ùå Error en registro:', pm.response.code);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"nombre\": \"name\",\n  \"email\": \"namee@email.com\",\n  \"password\": \"1234\",\n  \"clase\": \"user\",\n  \"nivel\": \"intermedio\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/auth/register",
          "host": ["{{base_url}}"],
          "path": ["api", "auth", "register"]
        },
        "description": "Registra un nuevo usuario y guarda su ID y nombre en variables"
      }
    },
    {
      "name": "2. AUTH - Login",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 200) {",
              "    const response = pm.response.json();",
              "    const user = response.user;",
              "    ",
              "    if (user && user.id) {",
              "        pm.environment.set('user_id', user.id);",
              "        pm.environment.set('user_nombre', user.nombre);",
              "        console.log('‚úÖ User ID guardado:', user.id);",
              "        console.log('‚úÖ User nombre guardado:', user.nombre);",
              "    }",
              "    ",
              "    if (response.token) {",
              "        pm.environment.set('auth_token', response.token);",
              "        console.log('‚úÖ Token guardado');",
              "    }",
              "} else {",
              "    console.error('‚ùå Error en login:', pm.response.code);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"email\": \"namee@email.com\",\n  \"password\": \"1234\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/auth/login",
          "host": ["{{base_url}}"],
          "path": ["api", "auth", "login"]
        },
        "description": "Hace login y actualiza las variables user_id y user_nombre"
      }
    },
    {
      "name": "3. POSTS - Create Post",
      "event": [
        {
          "listen": "prerequest",
          "script": {
            "exec": [
              "const userId = pm.environment.get('user_id');",
              "const userName = pm.environment.get('user_nombre');",
              "",
              "console.log('üîç Verificando variables antes del request:');",
              "console.log('   user_id:', userId || '‚ùå NO DEFINIDA');",
              "console.log('   user_nombre:', userName || '‚ùå NO DEFINIDA');",
              "",
              "if (!userId || !userName) {",
              "    console.error('‚ùå ERROR: Ejecuta primero \"1. AUTH - Register User\" o \"2. AUTH - Login\"');",
              "    throw new Error('Variables user_id o user_nombre no est√°n definidas. Ejecuta primero el registro o login.');",
              "}"
            ]
          }
        },
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    console.log('üì¶ Response:', JSON.stringify(response, null, 2));",
              "    ",
              "    const post = response.post;",
              "    ",
              "    if (post && post.id) {",
              "        pm.environment.set('post_id', post.id);",
              "        console.log('‚úÖ Post ID guardado:', post.id);",
              "    } else if (post && post._id) {",
              "        pm.environment.set('post_id', post._id);",
              "        console.log('‚úÖ Post ID guardado:', post._id);",
              "    } else {",
              "        console.error('‚ùå No se encontr√≥ post.id en la respuesta');",
              "    }",
              "} else {",
              "    console.error('‚ùå Error al crear post:', pm.response.code);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"autor_id\": \"{{user_id}}\",\n  \"autor_nombre\": \"{{user_nombre}}\",\n  \"tipo\": \"discusion\",\n  \"categoria\": \"tecnica\",\n  \"titulo\": \"¬øC√≥mo mejorar el rev√©s?\",\n  \"contenido\": \"Llevo tiempo practicando pero soy muy malo. ¬øQu√© hago?\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/posts",
          "host": ["{{base_url}}"],
          "path": ["api", "posts"]
        },
        "description": "Crea un post usando las variables guardadas"
      }
    },
    {
      "name": "4. POSTS - Get Post",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/posts/{{post_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "posts", "{{post_id}}"]
        },
        "description": "Obtiene el post creado por su ID"
      }
    },
    {
      "name": "5. POSTS - Update Post",
      "request": {
        "method": "PUT",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"usuario_id\": \"{{user_id}}\",\n  \"titulo\": \"Ya he mejorado mi rev√©s\",\n  \"categoria\": \"partidos\",\n  \"contenido\": \"Ya he mejorado mucho. Ma√±ana voy al tenis de 8 a 10 ¬øQui√©n se viene?\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/posts/{{post_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "posts", "{{post_id}}"]
        },
        "description": "Actualiza el post"
      }
    },
    {
      "name": "6. POSTS - Like Post",
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"usuario_id\": \"{{user_id}}\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/posts/{{post_id}}/like",
          "host": ["{{base_url}}"],
          "path": ["api", "posts", "{{post_id}}", "like"]
        },
        "description": "Da like al post"
      }
    },
    {
      "name": "7. COMMENTS - Create Comment",
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "if (pm.response.code === 201) {",
              "    const response = pm.response.json();",
              "    console.log('üì¶ Response:', JSON.stringify(response, null, 2));",
              "    ",
              "    // Intentar diferentes estructuras de respuesta",
              "    let commentId = null;",
              "    ",
              "    if (response.comentario) {",
              "        commentId = response.comentario.id || response.comentario._id;",
              "    } else if (response.comment) {",
              "        commentId = response.comment.id || response.comment._id;",
              "    } else {",
              "        commentId = response.id || response._id;",
              "    }",
              "    ",
              "    if (commentId) {",
              "        pm.environment.set('comment_id', commentId);",
              "        console.log('‚úÖ Comment ID guardado:', commentId);",
              "    } else {",
              "        console.error('‚ùå No se encontr√≥ el ID del comentario en la respuesta');",
              "        console.error('Estructura recibida:', Object.keys(response));",
              "    }",
              "} else {",
              "    console.error('‚ùå Error al crear comentario:', pm.response.code);",
              "}"
            ]
          }
        }
      ],
      "request": {
        "method": "POST",
        "header": [
          {
            "key": "Content-Type",
            "value": "application/json"
          }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"entidad_tipo\": \"post\",\n  \"entidad_id\": \"{{post_id}}\",\n  \"usuario_id\": \"{{user_id}}\",\n  \"usuario_nombre\": \"{{user_nombre}}\",\n  \"texto\": \"As no one answers, I myself, will play the tennis match with myself\"\n}"
        },
        "url": {
          "raw": "{{base_url}}/api/comentarios",
          "host": ["{{base_url}}"],
          "path": ["api", "comentarios"]
        },
        "description": "Crea un comentario en el post"
      }
    },
    {
      "name": "8. COMMENTS - Get Comment",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/comentarios/{{comment_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "comentarios", "{{comment_id}}"]
        },
        "description": "Obtiene el comentario por su ID"
      }
    },
    {
      "name": "9. COMMENTS - List Comments by Entity",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/comentarios?entidad_tipo=post&entidad_id={{post_id}}&page=1&limit=20&sort=date&order=desc",
          "host": ["{{base_url}}"],
          "path": ["api", "comentarios"],
          "query": [
            {
              "key": "entidad_tipo",
              "value": "post"
            },
            {
              "key": "entidad_id",
              "value": "{{post_id}}"
            },
            {
              "key": "page",
              "value": "1"
            },
            {
              "key": "limit",
              "value": "20"
            },
            {
              "key": "sort",
              "value": "date"
            },
            {
              "key": "order",
              "value": "desc"
            }
          ]
        },
        "description": "Lista todos los comentarios del post"
      }
    },
    {
      "name": "10. POSTS - Get Post",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{base_url}}/api/posts/{{post_id}}",
          "host": ["{{base_url}}"],
          "path": ["api", "posts", "{{post_id}}"]
        },
        "description": "Obtiene el post nuevamente para verificar que el 'like' y el 'comentario' se hayan a√±adido correctamente."
      }
    }
  ]
}